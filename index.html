<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EdgeMind - LIVE</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè≠</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Share+Tech+Mono&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/command-bar.css">
    <link rel="stylesheet" href="css/cards.css">
    <link rel="stylesheet" href="css/metrics.css">
    <link rel="stylesheet" href="css/stream.css">
    <link rel="stylesheet" href="css/ai-agent.css">
    <link rel="stylesheet" href="css/scorecard.css">
    <link rel="stylesheet" href="css/line-oee.css">
    <link rel="stylesheet" href="css/equipment.css">
    <link rel="stylesheet" href="css/batch.css">
    <link rel="stylesheet" href="css/quality.css">
    <link rel="stylesheet" href="css/charts.css">
    <link rel="stylesheet" href="css/connection.css">
    <link rel="stylesheet" href="css/modals.css">
    <link rel="stylesheet" href="css/chat.css">
    <link rel="stylesheet" href="css/demo.css">
    <link rel="stylesheet" href="css/coo-views.css">
    <link rel="stylesheet" href="css/plant-views.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/responsive.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body data-theme="coo">
    <!-- ========== COMMAND BAR ========== -->
    <div class="command-bar">
        <div class="command-bar__left">
            <div class="logo">REPLY</div>
            <div class="divider"></div>
            <div class="title">EDGE MIND</div>
        </div>

        <div class="command-bar__center">
            <button class="persona-chip active" data-persona="coo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <rect x="4" y="4" width="16" height="16" rx="1"/>
                    <line x1="8" y1="8" x2="8" y2="10"/>
                    <line x1="12" y1="8" x2="12" y2="10"/>
                    <line x1="16" y1="8" x2="16" y2="10"/>
                    <line x1="8" y1="13" x2="8" y2="15"/>
                    <line x1="12" y1="13" x2="12" y2="15"/>
                    <line x1="16" y1="13" x2="16" y2="15"/>
                </svg>
                <span>COO</span>
                <span class="persona-chip__shortcut">1</span>
            </button>

            <button class="persona-chip" data-persona="plant">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                </svg>
                <span>Plant Mgr</span>
                <span class="persona-chip__shortcut">2</span>
            </button>

            <button class="persona-chip" data-persona="demo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <circle cx="12" cy="12" r="10"/>
                    <polygon points="10 8 16 12 10 16 10 8" fill="currentColor" stroke="none"/>
                </svg>
                <span>Demo Ctrl</span>
                <span class="persona-chip__shortcut">3</span>
            </button>
        </div>

        <div class="command-bar__right">
            <div class="status" id="system-status">
                <div class="status__dot"></div>
                <span>CONNECTING...</span>
            </div>
            <svg class="settings-icon" onclick="openSettingsModal()" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v6m0 6v6M4.22 4.22l4.24 4.24m5.08 5.08l4.24 4.24M1 12h6m6 0h6M4.22 19.78l4.24-4.24m5.08-5.08l4.24-4.24"/>
            </svg>
        </div>
    </div>

    <!-- ========== SUB-NAV BAR ========== -->
    <div class="sub-nav">
        <!-- COO Panel -->
        <div class="sub-nav__panel active" data-panel="coo">
            <button class="sub-nav__item active" data-view="coo-dashboard">Dashboard</button>
            <button class="sub-nav__item" data-view="coo-enterprise">Enterprise Comparison</button>
            <button class="sub-nav__item" data-view="coo-trends">Trend Analysis</button>
            <button class="sub-nav__item" data-view="coo-agent">Agent Q&A</button>
        </div>

        <!-- Plant Manager Panel -->
        <div class="sub-nav__panel" data-panel="plant">
            <button class="sub-nav__item active" data-view="plant-line-status">Line Status</button>
            <button class="sub-nav__item" data-view="plant-oee-drilldown">OEE Drill-down</button>
            <button class="sub-nav__item" data-view="plant-equipment">Equipment Health</button>
            <button class="sub-nav__item" data-view="plant-alerts">Alerts & Work Orders</button>
        </div>

        <!-- Demo Control Panel -->
        <div class="sub-nav__panel" data-panel="demo">
            <button class="sub-nav__item active" data-view="demo-scenarios">Scenario Selector</button>
            <button class="sub-nav__item" data-view="demo-inject">Inject Anomaly</button>
            <button class="sub-nav__item" data-view="demo-reset">Reset Data</button>
        </div>
    </div>

    <div class="content">
        <!-- Existing Dashboard wrapped in persona-view -->
        <div class="persona-view active" data-view="coo-dashboard">
            <div class="dashboard-grid">
            <!-- Factory Selection -->
            <div class="card factory-overview" id="factory-overview">
                <div class="card-title">
                    Virtual Factory Selection
                </div>
                <div class="factory-selector">
                    <div class="factory-btn active" data-factory="ALL">
                        <div>ALL ENTERPRISES</div>
                        <div class="factory-status">Combined View ‚Ä¢ Online</div>
                    </div>
                    <div class="factory-btn" data-factory="A">
                        <div>ENTERPRISE A</div>
                        <div class="factory-status">Glass Manufacturing ‚Ä¢ Online</div>
                    </div>
                    <div class="factory-btn" data-factory="B">
                        <div>ENTERPRISE B</div>
                        <div class="factory-status">Multi-Site Beverage ‚Ä¢ Online</div>
                    </div>
                    <div class="factory-btn" data-factory="C">
                        <div>ENTERPRISE C</div>
                        <div class="factory-status">Biotech Facility ‚Ä¢ Online</div>
                    </div>
                </div>
            </div>

            <!-- Metrics -->
            <div class="card metrics" id="messages-metric">
                <div class="card-title">
                    Messages Received
                </div>
                <div class="metric-value" id="message-count">0</div>
                <div class="metric-label">Total MQTT Messages</div>
                <div class="metric-change positive">Live from broker</div>
            </div>

            <div class="card metrics" id="oee-metric">
                <div class="card-title">
                    OEE Score
                </div>
                <div class="metric-value" style="color: var(--accent-green);" id="oee-score">--</div>
                <div class="metric-label">24h Average</div>
                <div class="metric-change positive" id="oee-status">Loading...</div>
            </div>

            <div class="card metrics" id="sensors-metric">
                <div class="card-title">
                    Active Sensors
                </div>
                <div class="metric-value" style="color: var(--accent-amber);" id="active-sensors">--</div>
                <div class="metric-label">Data Streams</div>
                <div class="metric-change positive">Detecting...</div>
            </div>

            <div class="card metrics" id="anomalies-metric">
                <div class="card-title">
                    Anomalies
                </div>
                <div class="metric-value" style="color: var(--accent-magenta);" id="anomaly-count">0</div>
                <div class="metric-label">Detected by Claude</div>
                <div class="metric-change negative">AI Analysis Active</div>
            </div>

            <!-- Factory Events -->
            <div class="card live-stream" id="live-stream">
                <div class="card-title">
                    Factory Events
                    <button class="expand-btn" data-card-id="live-stream" title="Expand"><svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 5V1h4M9 1h4v4M13 9v4H9M5 13H1V9"/></svg></button>
                </div>
                <div class="event-filter-tabs">
                    <button class="event-tab active" onclick="filterEvents('all', this)">All</button>
                    <button class="event-tab" onclick="filterEvents('oee', this)">OEE</button>
                    <button class="event-tab" onclick="filterEvents('state', this)">State</button>
                    <button class="event-tab" onclick="filterEvents('alarm', this)">Alarms</button>
                    <button class="event-tab pause-btn" id="stream-pause-btn" onclick="toggleStreamPause()">
                        <span id="pause-btn-text">‚è∏ Pause</span>
                    </button>
                </div>
                <div class="stream-container" id="mqtt-stream">
                    <div class="stream-line">
                        <span class="stream-timestamp">[--:--:--.---]</span>
                        <span class="stream-topic">Waiting for connection...</span>
                        <span class="stream-value"></span>
                    </div>
                </div>
            </div>

            <!-- AI Agent -->
            <div class="card ai-agent" id="ai-agent">
                <div class="card-title">
                    Claude AI Agent
                    <button class="expand-btn" data-card-id="ai-agent" title="Expand"><svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 5V1h4M9 1h4v4M13 9v4H9M5 13H1V9"/></svg></button>
                </div>
                <div class="agent-header">
                    <div class="agent-avatar">C</div>
                    <div class="agent-status">
                        <div class="agent-name">Edge Minder</div>
                        <div class="agent-state" id="agent-state">‚óè Initializing...</div>
                    </div>
                </div>
                <div class="insight-tabs">
                    <button class="insight-tab active" onclick="filterInsights('all', this)">All Insights</button>
                    <button class="insight-tab" onclick="filterInsights('anomalies', this)">Anomalies (<span id="anomaly-tab-count">0</span>)</button>
                </div>
                <div class="anomaly-filter-control">
                    <div class="filter-input-group">
                        <input type="text" id="anomaly-filter-input" class="filter-input"
                               placeholder="Add filter rule (e.g., 'ignore anomalies below 10% deviation')"
                               maxlength="200">
                        <button class="filter-submit-btn" onclick="addAnomalyFilter()">Add Filter</button>
                    </div>
                    <div id="active-filters" class="active-filters-container"></div>
                </div>
                <div id="claude-insights-container">
                    <div class="agent-insights">
                        <div class="insight-text">
                            Waiting for data to analyze. Claude will provide real-time insights as factory data flows in...
                        </div>
                        <div class="insight-meta">Status: Standby ‚Ä¢ Waiting for MQTT messages</div>
                    </div>
                </div>
            </div>

            <!-- Factory Health Scorecard -->
            <div class="card health-scorecard" id="health-scorecard">
                <div class="card-title">
                    Factory Health Scorecard
                    <button class="expand-btn" data-card-id="health-scorecard" title="Expand"><svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 5V1h4M9 1h4v4M13 9v4H9M5 13H1V9"/></svg></button>
                </div>
                <div class="scorecard-content">
                    <!-- OEE Gauge -->
                    <div class="oee-gauge-container">
                        <div class="oee-gauge">
                            <svg width="180" height="180">
                                <circle class="oee-gauge-bg" cx="90" cy="90" r="80"></circle>
                                <circle id="oee-gauge-fill" class="oee-gauge-fill" cx="90" cy="90" r="80"
                                        stroke-dasharray="502.65" stroke-dashoffset="502.65"></circle>
                            </svg>
                            <div class="oee-gauge-text">
                                <div class="oee-value" id="scorecard-oee-value">--</div>
                                <div class="oee-label">Overall OEE</div>
                            </div>
                        </div>
                        <div class="health-status">
                            <div class="status-indicator">
                                <div class="status-dot green" id="status-dot-healthy"></div>
                                <span id="status-text-healthy">Healthy</span>
                            </div>
                            <div class="status-indicator">
                                <div class="status-dot yellow" id="status-dot-warning"></div>
                                <span id="status-text-warning">Warning</span>
                            </div>
                            <div class="status-indicator">
                                <div class="status-dot red" id="status-dot-critical"></div>
                                <span id="status-text-critical">Critical</span>
                            </div>
                        </div>
                    </div>

                    <!-- Active Alerts -->
                    <div>
                        <div style="font-size: 0.9rem; font-weight: 700; margin-bottom: 10px; color: var(--accent-cyan);">Active Alerts</div>
                        <div id="active-alerts-list">
                            <div class="alert-item info">
                                <div class="alert-header">
                                    <span class="alert-severity" style="color: var(--accent-cyan);">INFO</span>
                                    <span class="alert-time">now</span>
                                </div>
                                <div class="alert-message">
                                    System initializing. Connecting to MQTT broker...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Equipment State Monitor -->
            <div class="card equipment-state-panel" id="equipment-state-panel">
                <div class="card-title">
                    Equipment State Monitor
                    <button class="expand-btn" data-card-id="equipment-state-panel" title="Expand"><svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 5V1h4M9 1h4v4M13 9v4H9M5 13H1V9"/></svg></button>
                </div>
                <div class="state-summary">
                    <div class="state-count running"><span id="state-running">0</span> Running</div>
                    <div class="state-count idle"><span id="state-idle">0</span> Idle</div>
                    <div class="state-count down"><span id="state-down">0</span> Down</div>
                </div>
                <div class="state-grid" id="equipment-state-grid">
                    <div class="heatmap-loading">Loading equipment states...</div>
                </div>
            </div>

            <!-- Production Line OEE -->
            <div class="card line-oee-panel" id="line-oee-panel">
                <div class="card-title" id="line-panel-title">
                    Production Line OEE
                    <button class="expand-btn" data-card-id="line-oee-panel" title="Expand"><svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 5V1h4M9 1h4v4M13 9v4H9M5 13H1V9"/></svg></button>
                </div>
                <div class="line-oee-grid" id="line-oee-grid">
                    <div class="heatmap-loading">Loading line OEE...</div>
                </div>
            </div>

            <!-- Chart Panels -->
            <div class="card chart-panel" id="oee-breakdown-chart-panel">
                <div class="card-title">
                    OEE by Enterprise
                    <button class="expand-btn" data-card-id="oee-breakdown-chart-panel" title="Expand"><svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 5V1h4M9 1h4v4M13 9v4H9M5 13H1V9"/></svg></button>
                </div>
                <canvas id="oee-breakdown-chart"></canvas>
            </div>

            <div class="card chart-panel waste-chart" id="waste-chart-panel">
                <div class="card-title">
                    Waste & Defect Trends (24h)
                    <button class="expand-btn" data-card-id="waste-chart-panel" title="Expand"><svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 5V1h4M9 1h4v4M13 9v4H9M5 13H1V9"/></svg></button>
                </div>
                <canvas id="waste-trend-chart"></canvas>
            </div>

            <div class="card chart-panel" id="scrap-chart-panel">
                <div class="card-title">
                    Scrap by Production Line
                    <button class="expand-btn" data-card-id="scrap-chart-panel" title="Expand"><svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 5V1h4M9 1h4v4M13 9v4H9M5 13H1V9"/></svg></button>
                </div>
                <canvas id="scrap-by-line-chart"></canvas>
            </div>

            <!-- Quality Metrics Panel -->
            <div class="card quality-panel" id="quality-panel">
                <div class="card-title">
                    Quality Metrics by Enterprise
                    <button class="expand-btn" data-card-id="quality-panel" title="Expand"><svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 5V1h4M9 1h4v4M13 9v4H9M5 13H1V9"/></svg></button>
                </div>
                <div class="quality-grid" id="quality-grid">
                    <div class="heatmap-loading">Loading quality metrics...</div>
                </div>
            </div>

            <div class="card chart-panel" id="heatmap">
                <div class="card-title">
                    Production Heatmap
                    <button class="expand-btn" data-card-id="heatmap" title="Expand"><svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 5V1h4M9 1h4v4M13 9v4H9M5 13H1V9"/></svg></button>
                </div>
                <div class="heatmap-container" id="production-heatmap">
                    <div class="heatmap-loading">Loading factory status...</div>
                </div>
            </div>

            <!-- Connection Status -->
            <div class="connection-status">
                <div class="connection-item">
                    <div class="connection-indicator disconnected" id="mqtt-indicator"></div>
                    <div class="connection-info">
                        <span class="connection-label">MQTT Broker</span>
                        <span class="connection-value">virtualfactory.proveit.services:1883</span>
                    </div>
                </div>
                <div class="connection-item">
                    <div class="connection-indicator disconnected" id="claude-indicator"></div>
                    <div class="connection-info">
                        <span class="connection-label">AI Agent</span>
                        <span class="connection-value">Claude Sonnet 4 ‚Ä¢ Standby</span>
                    </div>
                </div>
                <div class="connection-item">
                    <div class="connection-indicator disconnected" id="data-indicator"></div>
                    <div class="connection-info">
                        <span class="connection-label">Data Rate</span>
                        <span class="connection-value" id="data-rate">0 msg/sec</span>
                    </div>
                </div>
            </div>
        </div>
        </div><!-- End coo-dashboard persona-view -->

        <!-- ========== COO PERSONA VIEWS ========== -->
        <div class="persona-view" data-view="coo-enterprise">
            <div class="view-header">
                <h2 class="view-title">Enterprise Comparison</h2>
            </div>
            <div id="enterprise-comparison-grid" class="enterprise-comparison-grid">
                <div class="view-loading">Loading enterprise data...</div>
            </div>
        </div>

        <div class="persona-view" data-view="coo-trends">
            <div class="view-header">
                <h2 class="view-title">Trend Analysis</h2>
            </div>
            <div class="trends-chart-grid">
                <div class="trend-chart-container">
                    <h3 class="chart-title">OEE by Enterprise</h3>
                    <canvas id="coo-oee-chart"></canvas>
                </div>
                <div class="trend-chart-container">
                    <h3 class="chart-title">Waste &amp; Defect Trends</h3>
                    <canvas id="coo-waste-chart"></canvas>
                </div>
                <div class="trend-chart-container">
                    <h3 class="chart-title">Equipment State Distribution</h3>
                    <canvas id="coo-equipment-chart"></canvas>
                </div>
            </div>
        </div>

        <div class="persona-view" data-view="coo-agent">
            <div class="view-header">
                <h2 class="view-title">Agent Q&amp;A</h2>
            </div>
            <div class="agent-qa-container">
                <div class="suggested-questions-grid">
                    <button class="suggested-q-btn" onclick="askCOOQuestion('What is the current factory health?')">What is the current factory health?</button>
                    <button class="suggested-q-btn" onclick="askCOOQuestion('Which enterprise has the lowest OEE?')">Which enterprise has the lowest OEE?</button>
                    <button class="suggested-q-btn" onclick="askCOOQuestion('What equipment is currently faulted?')">What equipment is currently faulted?</button>
                    <button class="suggested-q-btn" onclick="askCOOQuestion('Where is waste coming from?')">Where is waste coming from?</button>
                    <button class="suggested-q-btn" onclick="askCOOQuestion('What are the biggest production risks?')">What are the biggest production risks?</button>
                    <button class="suggested-q-btn" onclick="askCOOQuestion('Compare Enterprise A vs B vs C')">Compare Enterprise A vs B vs C</button>
                </div>
                <div class="agent-input-area">
                    <textarea id="coo-agent-input" class="agent-textarea" placeholder="Ask a question about factory performance..." rows="3"></textarea>
                    <button id="coo-agent-send" class="agent-send-btn" onclick="sendCOOQuestion()">Ask Agent</button>
                </div>
                <div id="coo-agent-response" class="agent-response">
                    <div class="agent-response-placeholder">Ask a question to get AI-powered factory analysis</div>
                </div>
                <div id="coo-recent-questions" class="recent-questions"></div>
            </div>
        </div>

        <!-- ========== PLANT MANAGER PERSONA VIEWS ========== -->
        <div class="persona-view" data-view="plant-line-status">
            <div class="view-header">
                <h2 class="view-title">Line Status</h2>
            </div>
            <div id="line-status-grid" class="line-status-grid">
                <div class="view-loading">Loading line data...</div>
            </div>
        </div>

        <div class="persona-view" data-view="plant-oee-drilldown">
            <div class="view-header">
                <h2 class="view-title">OEE Drill-down</h2>
            </div>
            <div id="oee-drilldown-container" class="oee-drilldown-layout">
                <div class="oee-big-display" id="oee-big-display">
                    <div class="view-loading">Loading OEE data...</div>
                </div>
                <div class="oee-chart-container">
                    <h3 class="chart-title">OEE by Line</h3>
                    <canvas id="plant-oee-lines-chart"></canvas>
                </div>
                <div class="oee-chart-container">
                    <h3 class="chart-title">Waste Breakdown</h3>
                    <canvas id="plant-waste-chart"></canvas>
                </div>
            </div>
        </div>

        <div class="persona-view" data-view="plant-equipment">
            <div class="view-header">
                <h2 class="view-title">Equipment Health</h2>
            </div>
            <div class="equipment-summary-bar" id="equipment-summary"></div>
            <div class="filter-btn-group">
                <button class="filter-btn active" onclick="filterEquipmentByState('all')">All</button>
                <button class="filter-btn" onclick="filterEquipmentByState('running')">Running</button>
                <button class="filter-btn" onclick="filterEquipmentByState('stopped')">Stopped</button>
                <button class="filter-btn" onclick="filterEquipmentByState('faulted')">Faulted</button>
            </div>
            <div id="equipment-grid" class="equipment-grid">
                <div class="view-loading">Loading equipment data...</div>
            </div>
        </div>

        <div class="persona-view" data-view="plant-alerts">
            <div class="view-header">
                <h2 class="view-title">Alerts &amp; Work Orders</h2>
            </div>
            <div class="alerts-layout">
                <div class="alerts-section">
                    <h3 class="section-title">Active Alerts</h3>
                    <div class="filter-btn-group">
                        <button class="filter-btn active" onclick="filterAlertsBySeverity('all')">All</button>
                        <button class="filter-btn" onclick="filterAlertsBySeverity('critical')">Critical</button>
                        <button class="filter-btn" onclick="filterAlertsBySeverity('warning')">Warning</button>
                        <button class="filter-btn" onclick="filterAlertsBySeverity('info')">Info</button>
                    </div>
                    <div id="alerts-list" class="alerts-list">
                        <div class="view-loading">Loading alerts...</div>
                    </div>
                </div>
                <div class="work-orders-section">
                    <h3 class="section-title">Work Orders</h3>
                    <div id="work-orders-list" class="work-orders-list">
                        <div class="view-loading">Loading work orders...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== DEMO CONTROL PERSONA VIEWS ========== -->
        <div class="persona-view" data-view="demo-scenarios">
            <div class="demo-scenarios-container">
                <div class="demo-header">
                    <h2 class="demo-title">Scenario Selector</h2>
                    <p class="demo-subtitle">Pre-configured demo scenarios for ProveIt! Conference 2026</p>
                </div>
                <div class="scenario-grid" id="scenario-grid">
                    <!-- Scenarios loaded dynamically -->
                    <div class="scenario-loading">Loading scenarios...</div>
                </div>
            </div>
        </div>

        <div class="persona-view" data-view="demo-inject">
            <div class="demo-inject-container">
                <div class="demo-header">
                    <h2 class="demo-title">Inject Anomaly</h2>
                    <p class="demo-subtitle">Manual anomaly injection for live demonstrations</p>
                </div>

                <div class="inject-panel card">
                    <div class="card-title">Injection Controls</div>
                    <div class="inject-form">
                        <div class="inject-field">
                            <label class="inject-label">Equipment</label>
                            <select id="inject-equipment" class="inject-input inject-select">
                                <option value="" disabled selected>Select equipment...</option>
                            </select>
                        </div>

                        <div class="inject-field">
                            <label class="inject-label">Anomaly Type</label>
                            <div class="inject-radio-group" id="inject-anomaly-types">
                                <!-- Populated dynamically from /api/demo/profiles -->
                            </div>
                        </div>

                        <div class="inject-field">
                            <label class="inject-label">Severity</label>
                            <div class="severity-slider-container">
                                <input type="range"
                                       id="inject-severity"
                                       class="severity-slider"
                                       min="1" max="3" step="1" value="2">
                                <div class="severity-labels">
                                    <span>Mild</span>
                                    <span>Moderate</span>
                                    <span>Severe</span>
                                </div>
                            </div>
                        </div>

                        <div class="inject-field">
                            <label class="inject-label">Duration (seconds)</label>
                            <div class="duration-slider-container">
                                <input type="range"
                                       id="inject-duration"
                                       class="duration-slider"
                                       min="30" max="300" step="30" value="120">
                                <div class="duration-value"><span id="inject-duration-value">120</span>s</div>
                            </div>
                        </div>

                        <button class="inject-btn" id="inject-start-btn">
                            INJECT ANOMALY
                        </button>

                        <div class="inject-status">
                            <span class="inject-status-label">Max Concurrent:</span>
                            <span id="inject-concurrent-count">0</span> / <span id="inject-concurrent-max">3</span>
                        </div>
                    </div>
                </div>

                <div class="active-injections-panel card">
                    <div class="card-title">Active Injections</div>
                    <div id="active-injections-list">
                        <div class="no-injections">No active injections</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="persona-view" data-view="demo-reset">
            <div class="demo-reset-container">
                <div class="demo-header">
                    <h2 class="demo-title">Reset & Timer</h2>
                    <p class="demo-subtitle">Data reset controls and presentation timer</p>
                </div>

                <div class="reset-panel card">
                    <div class="card-title">Reset Controls</div>
                    <div class="reset-options">
                        <div class="reset-option">
                            <div class="reset-option-header">
                                <div class="reset-option-title">Reset Injected Data</div>
                                <button class="reset-btn reset-btn-primary" onclick="demoResetData('injected-data')">
                                    RESET INJECTIONS
                                </button>
                            </div>
                            <div class="reset-option-desc">
                                Clears demo-injected InfluxDB data points only. Stops all active injections. Factory baseline data remains intact.
                            </div>
                        </div>

                        <div class="reset-option">
                            <div class="reset-option-header">
                                <div class="reset-option-title">Reset All Scenarios</div>
                                <button class="reset-btn reset-btn-warning" onclick="demoResetData('all-scenarios')">
                                    RESET SCENARIOS
                                </button>
                            </div>
                            <div class="reset-option-desc">
                                Stops all running scenarios and clears scenario-generated data. Use this between different scenario demos.
                            </div>
                        </div>

                        <div class="reset-option">
                            <div class="reset-option-header">
                                <div class="reset-option-title">Full Reset</div>
                                <button class="reset-btn reset-btn-danger" onclick="demoResetData('full')">
                                    FULL RESET
                                </button>
                            </div>
                            <div class="reset-option-desc">
                                Nuclear option. Stops all scenarios and injections, clears all demo data. Use this for a clean slate between presentations.
                            </div>
                        </div>
                    </div>
                </div>

                <div class="timer-panel card">
                    <div class="card-title">Presentation Timer</div>
                    <div class="timer-display">
                        <div class="timer-value" id="timer-display">00:00</div>
                        <div class="timer-status" id="timer-status">Ready</div>
                    </div>

                    <div class="timer-presets">
                        <button class="timer-preset-btn" onclick="setTimerPreset(300)">5 min</button>
                        <button class="timer-preset-btn" onclick="setTimerPreset(600)">10 min</button>
                        <button class="timer-preset-btn" onclick="setTimerPreset(900)">15 min</button>
                        <button class="timer-preset-btn" onclick="setTimerPreset(1200)">20 min</button>
                        <input type="number"
                               id="timer-custom-input"
                               class="timer-custom-input"
                               placeholder="Custom (min)"
                               min="1" max="120">
                        <button class="timer-preset-btn" onclick="setTimerCustom()">Set</button>
                    </div>

                    <div class="timer-controls">
                        <button class="timer-control-btn timer-start" id="timer-start-btn" onclick="startTimer()">
                            START
                        </button>
                        <button class="timer-control-btn timer-pause" id="timer-pause-btn" onclick="pauseTimer()" disabled>
                            PAUSE
                        </button>
                        <button class="timer-control-btn timer-reset" id="timer-reset-btn" onclick="resetTimer()">
                            RESET
                        </button>
                    </div>

                    <div class="timer-options">
                        <label class="timer-option-checkbox">
                            <input type="checkbox" id="timer-audio-enabled">
                            <span>Audio alert at 0:00</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

    </div><!-- End .content -->

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="powered-by">Powered by</div>
            <div class="reply-footer-logo">REPLY</div>
            <div class="footer-divider"></div>
            <div class="footer-tagline">Driving Digital Transformation</div>
        </div>
    </footer>

    <script type="module" src="js/app.js"></script>

    <!-- Agent Modal Overlay -->
    <div class="agent-modal-overlay" id="agent-modal-overlay">
        <div class="agent-modal">
            <div class="agent-modal-header">
                <div class="agent-modal-title">
                    <div class="agent-avatar-small">C</div>
                    <span>Edge Minder - AI Insights</span>
                </div>
                <button class="agent-modal-close modal-close-btn" onclick="closeAgentModal()">√ó</button>
            </div>
            <div class="agent-modal-tabs">
                <button class="insight-tab active" onclick="filterModalInsights('all', this)">All Insights</button>
                <button class="insight-tab" onclick="filterModalInsights('anomalies', this)">Anomalies (<span id="modal-anomaly-count">0</span>)</button>
            </div>
            <div class="agent-modal-content" id="agent-modal-content">
                <!-- Insights rendered here -->
            </div>
        </div>
    </div>

    <!-- Anomaly Details Modal -->
    <div class="anomaly-modal-overlay" id="anomaly-modal-overlay">
        <div class="anomaly-modal">
            <div class="anomaly-modal-header">
                <div class="anomaly-modal-title">Anomaly Details</div>
                <button class="anomaly-modal-close modal-close-btn" id="close-anomaly-modal">√ó</button>
            </div>
            <div class="anomaly-modal-content">
                <div class="anomaly-modal-text" id="anomaly-modal-text"></div>
                <div class="anomaly-modal-reasoning" id="anomaly-modal-reasoning"></div>
                <div class="anomaly-modal-meta">
                    <div class="anomaly-modal-meta-item">
                        <div class="anomaly-modal-meta-label">Severity</div>
                        <div class="anomaly-modal-meta-value" id="anomaly-modal-severity"></div>
                    </div>
                    <div class="anomaly-modal-meta-item">
                        <div class="anomaly-modal-meta-label">Detected At</div>
                        <div class="anomaly-modal-meta-value" id="anomaly-modal-timestamp"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal-overlay" id="settings-modal-overlay">
        <div class="settings-modal">
            <div class="settings-modal-header">
                <div class="settings-modal-title">Alert Threshold Settings</div>
                <button class="settings-modal-close modal-close-btn" onclick="closeSettingsModal()">√ó</button>
            </div>
            <div class="settings-modal-content">
                <div class="settings-group">
                    <label class="settings-label">OEE Baseline (%) - Below this is concerning</label>
                    <input type="number" id="setting-oeeBaseline" class="settings-input" min="0" max="100" step="1">
                </div>
                <div class="settings-group">
                    <label class="settings-label">OEE World Class (%) - Above this is excellent</label>
                    <input type="number" id="setting-oeeWorldClass" class="settings-input" min="0" max="100" step="1">
                </div>
                <div class="settings-group">
                    <label class="settings-label">Availability Minimum (%) - Below this is critical</label>
                    <input type="number" id="setting-availabilityMin" class="settings-input" min="0" max="100" step="1">
                </div>
                <div class="settings-group">
                    <label class="settings-label">Defect Rate Warning (%) - Above this triggers warning</label>
                    <input type="number" id="setting-defectRateWarning" class="settings-input" min="0" max="100" step="0.1">
                </div>
                <div class="settings-group">
                    <label class="settings-label">Defect Rate Critical (%) - Above this triggers critical</label>
                    <input type="number" id="setting-defectRateCritical" class="settings-input" min="0" max="100" step="0.1">
                </div>
                <div class="settings-actions">
                    <button class="settings-save-btn" onclick="saveSettings()">Save Settings</button>
                    <button class="settings-cancel-btn" onclick="closeSettingsModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ask Agent Chat Panel -->
    <div class="chat-panel" id="chat-panel">
        <div class="chat-header">
            <div class="chat-title">Ask Agent</div>
            <button class="chat-close-btn" onclick="toggleChatPanel()">√ó</button>
        </div>
        <div class="chat-messages" id="chat-messages">
            <div class="chat-welcome">
                Ask me anything about the factory data. Try one of these:
            </div>
            <div class="suggested-questions">
                <button class="suggested-question" onclick="handleSuggestedQuestion('What is impacting Enterprise B\'s OEE?')">
                    What is impacting Enterprise B's OEE?
                </button>
                <button class="suggested-question" onclick="handleSuggestedQuestion('Which equipment has been down the longest?')">
                    Which equipment has been down the longest?
                </button>
                <button class="suggested-question" onclick="handleSuggestedQuestion('Where is waste coming from in Enterprise A?')">
                    Where is waste coming from in Enterprise A?
                </button>
                <button class="suggested-question" onclick="handleSuggestedQuestion('What is the status of Enterprise C batches?')">
                    What is the status of Enterprise C batches?
                </button>
            </div>
        </div>
        <div class="chat-input-container">
            <input type="text" id="chat-input" class="chat-input" placeholder="Ask about factory data..." />
            <button class="chat-send-btn" onclick="sendChatMessage()">
                <span>‚ñ∂</span>
            </button>
        </div>
    </div>

    <button class="chat-toggle-btn" id="chat-toggle-btn" onclick="toggleChatPanel()">
        üí¨ Ask Agent
    </button>

    <!-- Generic Card Modal Overlay -->
    <div class="card-modal-overlay" id="card-modal-overlay">
        <div class="card-modal">
            <div class="card-modal-header">
                <span class="card-modal-title" id="card-modal-title"></span>
                <button class="modal-close-btn" onclick="closeCardModal()">√ó</button>
            </div>
            <div class="card-modal-content" id="card-modal-content"></div>
        </div>
    </div>

</body>
</html>
